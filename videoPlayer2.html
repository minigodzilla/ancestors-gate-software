<!DOCTYPE html>
<html>

<head>
    <title>Video Player 2</title>
    <link rel="shortcut icon" href="#">
    <script type="text/javascript" src="js/videoSyncWorker.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <audio class="tone" id="tone-1" src="assets/audio/dial-1.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-2" src="assets/audio/dial-2.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-3" src="assets/audio/dial-3.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-4" src="assets/audio/dial-4.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-5" src="assets/audio/dial-5.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-6" src="assets/audio/dial-6.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-7" src="assets/audio/dial-7.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-8" src="assets/audio/dial-8.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-9" src="assets/audio/dial-9.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-star" src="assets/audio/dial-star.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-0" src="assets/audio/dial-0.ogg" preload="auto"></audio>
    <audio class="tone" id="tone-pound" src="assets/audio/dial-pound.ogg" preload="auto"></audio>

    <video id="video-fwd" src="assets/video/portal-fwd-tl.mp4" muted></video>
    <video id="video-rev" src="assets/video/portal-rev-tl.mp4" muted></video>
    <video id="video-hangup" src="assets/video/portal-hangup-tl.mp4" muted></video>

    <div class="dps-container">
        <div class="dps left dps-paoakalani">
            <h1>Ku ªu Pua I Paoakalani</h1>
            <div class="article">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut non suscipit libero. Pellentesque aliquam felis elit, nec consequat diam pretium convallis. Nam non dapibus mi, eget posuere ex. Phasellus at felis at velit ornare semper vitae sit amet urna. Aliquam erat volutpat. Nulla facilisis nec eros a faucibus. Morbi laoreet viverra maximus. Aenean at sem dapibus leo varius vulputate. Cras sagittis pharetra urna ac molestie.</p>
                <p>Donec quis felis feugiat, porta dolor in, viverra arcu. Ut mollis imperdiet sagittis. Nunc posuere rutrum rutrum. Pellentesque congue fringilla tellus, eu ornare sapien pulvinar quis. Mauris at lacus luctus, porttitor nulla ac, aliquet orci. Nullam tortor ipsum, faucibus vitae neque ullamcorper, iaculis rhoncus sapien. Morbi ac mi neque. Nullam fermentum interdum tortor, sed auctor lectus tempor vitae. Phasellus ut viverra est. Ut porta sapien et ex euismod, eu efficitur lectus vehicula. Sed a mauris non diam ultrices rhoncus eget ut turpis. Nunc mollis consequat ex ut sodales. Quisque a commodo leo, in suscipit augue. Curabitur semper risus vitae lacus pulvinar, vel efficitur ligula ultricies. Etiam et tellus luctus, tempor risus a, rutrum arcu.</p>
                <p>In rhoncus nunc id lorem fermentum luctus. Vestibulum dolor mi, pretium faucibus blandit nec, faucibus ac lacus. Donec at nibh sed ipsum venenatis lobortis vitae vel est. In hac habitasse platea dictumst. Vivamus leo erat, tincidunt ut varius ut, elementum vitae magna. Ut sit amet augue vitae dolor fermentum aliquet sed vitae lectus. Pellentesque rutrum sagittis lacus, ac lobortis magna ultrices at.</p>
                <p>Maecenas congue gravida leo, non interdum diam interdum nec. Curabitur sapien nulla, molestie ultricies interdum eu, hendrerit sed metus. Proin et libero vestibulum, fringilla.</p>
            </div>
        </div>
    </div>











    <script type="text/javascript">
        const videoFwd = document.getElementById('video-fwd');
        const videoRev = document.getElementById('video-rev');
        const videoHangup = document.getElementById('video-hangup');
        const dps = document.querySelector('.dps-paoakalani');
        let dpsShownAfterContentFinishedTimeout;
        let dpsShownAfterUserHangsUpTimeout;
        let dpsShownAfter10SecondsTimeout;

        let postMessageHandler = function (event) {

            if (event.data === 'userHungUpDuringCountdown') {
                videoFwd.classList.remove("show");
                videoFwd.pause();
            } else if (event.data === 'userHungUpDuringPortal') {
                videoFwd.classList.remove("show");
                videoHangup.classList.add("show");
                videoFwd.pause();
                videoHangup.play();
            } else if (event.data === 'userHungUpDuringContent') {
                dps.classList.remove("show");
                dps.classList.add("no-animation");
                dpsIsShown = false;
                videoFwd.classList.remove("show");
                videoRev.classList.remove("show");
                videoHangup.classList.add("show");
                videoFwd.pause();
                videoHangup.play();

                // if user is invested, show DPS after 2.5 seconds and then hide after 1 minute
                if (userIsInvested) {
                    setTimeout(() => {
                        dps.classList.remove("no-animation", "half-opacity");
                        dps.classList.add("show");
                        dpsIsShown = true;
                        dpsShownAfterUserHangsUpTimeout = setTimeout(() => {
                            userIsInvested = false;
                            dps.classList.remove("show");
                            dpsIsShown = false;
                        }, 60000);
                    }, 2500);
                }
            } else if (event.data === 'userPickedUp') {
                // reset all timeouts and dps
                clearTimeout(dpsShownAfter10SecondsTimeout);
                clearTimeout(dpsShownAfterUserHangsUpTimeout);
                clearTimeout(dpsShownAfterContentFinishedTimeout);

                userIsInvested = false;
                dps.classList.remove("show");
                dpsIsShown = false;

                if (dpsIsShown) {
                    // iterate through all DPS and hide them
                    const dps = document.querySelectorAll('.dps');
                    for (let i = 0; i < dps; i++) {
                        dps[i].classList.remove("show");
                    }
                    dpsIsShown = false;
                }
                videoRev.classList.remove("show");
                videoHangup.classList.remove("show");

                setTimeout(() => {
                    videoFwd.classList.add("show"); // fixes a flicker
                }, 50);

                videoFwd.currentTime = 0;
                videoRev.currentTime = 0;
                videoHangup.currentTime = 0;
            } else if (event.data === 'inPortal') {
                videoFwd.play();
            } else if (event.data === 'inContent') {
                setTimeout(() => {
                    videoFwd.classList.remove("show");
                }, 50);
                // show DPS after 10 seconds
                dpsShownAfter10SecondsTimeout = setTimeout(() => {
                    if (inContent) {
                        userIsInvested = true;
                        console.log('userIsInvested: ' + userIsInvested);
                        dps.classList.remove("no-animation");
                        dps.classList.add("show", "half-opacity");
                        dpsIsShown = true;
                    }
                }, 10000);
            } else if (event.data === 'contentFinished') {
                dps.classList.add("no-animation");
                dps.classList.remove("show");
                dpsIsShown = false;
                videoFwd.classList.remove("show");
                videoRev.classList.add("show");
                videoRev.play();
                // show DPS after 5 seconds and then hide after 1 minute
                userIsInvested = false;
                setTimeout(() => {
                    dps.classList.remove("no-animation", "half-opacity");
                    dps.classList.add("show");
                    dpsIsShown = true;
                    dpsShownAfterContentFinishedTimeout = setTimeout(() => {
                        dps.classList.remove("show");
                        dpsIsShown = false;
                    }, 60000);
                }, 5000);
            }
        };

        // Function to generate HTML for each video and add it to the page
        function generateVideoHTML() {
            const container = document.querySelector('.dps-container');

            // Iterate through the videos object
            for (const videoKey in videos) {
                if (videos.hasOwnProperty(videoKey)) {
                    const video = videos[videoKey];

                    // Create HTML using template literals
                    const videoHTML = `
                        <div class="dps dps-${videoKey}">
                            <h1>${video.title}</h1>
                            <div class="article">
                                ${video.article}
                            </div>
                        </div>
                    `;

                    // Append the video HTML to the container
                    container.insertAdjacentHTML('beforeend', videoHTML);
                }
            }
        };

        // window.addEventListener('load', generateVideoHTML); 
    </script>
</body>

</html>